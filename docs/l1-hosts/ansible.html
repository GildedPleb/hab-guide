<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-l1-hosts/ansible">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Ansible | HAB Node</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://gildedpleb.github.io/hab-guide/img/og_image.png"><meta data-rh="true" name="twitter:image" content="https://gildedpleb.github.io/hab-guide/img/og_image.png"><meta data-rh="true" property="og:url" content="https://gildedpleb.github.io/hab-guide/docs/l1-hosts/ansible"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ansible | HAB Node"><meta data-rh="true" name="description" content="The word &quot;ansible&quot; comes from 1960s"><meta data-rh="true" property="og:description" content="The word &quot;ansible&quot; comes from 1960s"><link data-rh="true" rel="icon" href="/hab-guide/img/favicon.png"><link data-rh="true" rel="canonical" href="https://gildedpleb.github.io/hab-guide/docs/l1-hosts/ansible"><link data-rh="true" rel="alternate" href="https://gildedpleb.github.io/hab-guide/docs/l1-hosts/ansible" hreflang="en"><link data-rh="true" rel="alternate" href="https://gildedpleb.github.io/hab-guide/docs/l1-hosts/ansible" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/hab-guide/blog/rss.xml" title="HAB Node RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/hab-guide/blog/atom.xml" title="HAB Node Atom Feed"><link rel="stylesheet" href="/hab-guide/assets/css/styles.889964d7.css">
<link rel="preload" href="/hab-guide/assets/js/runtime~main.cfdfe1a9.js" as="script">
<link rel="preload" href="/hab-guide/assets/js/main.578d3d2c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<style data-styled="" data-styled-version="5.3.6"></style><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:pink;color:#091E42" role="banner"><div class="content_knG7 announcementBarContent_xLdY">The Guide is presently under active development, and requires additional undocumented steps to complete as is. See <a href="/hab-guide/docs/Introduction/intro"> Warning. </a></div></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/hab-guide/"><div class="navbar__logo"><img src="/hab-guide/img/ionico.png" alt="HAB Node logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/hab-guide/img/ionico.png" alt="HAB Node logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/hab-guide/poc">PoC</a><a class="navbar__item navbar__link" href="/hab-guide/why">Why?</a><a class="navbar__item navbar__link" href="/hab-guide/how">How?</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/hab-guide/docs/Introduction/intro">BYO</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/hab-guide/support">Support</a><a href="https://github.com/gildedpleb/hab-guide" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/hab-guide/"><img src="/hab-guide/img/ionico.png" alt="HAB Node logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/hab-guide/img/ionico.png" alt="HAB Node logo" class="themedImage_ToTc themedImage--dark_i4oU"><b></b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/hab-guide/docs/category/introduction">Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/hab-guide/docs/category/layer-1---hosts">Layer 1 - Hosts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Layer 1 - Hosts&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hab-guide/docs/l1-hosts/hardware">Hardware Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hab-guide/docs/l1-hosts/software">Software Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hab-guide/docs/l1-hosts/control-prep">Control Prep</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hab-guide/docs/l1-hosts/host-naming">Host Naming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/hab-guide/docs/l1-hosts/ansible">Ansible</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hab-guide/docs/l1-hosts/networking">Stand-up Raw Hosts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hab-guide/docs/l1-hosts/vanilla-host">Stand-up Vanilla Hosts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hab-guide/docs/l1-hosts/vanilla-recap">Stand-up Vanilla Recap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hab-guide/docs/l1-hosts/ansible-vault">Ansible Vault</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hab-guide/docs/l1-hosts/live-hosts">Stand-up Live Hosts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hab-guide/docs/l1-hosts/fin">Tear-down Live Hosts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/hab-guide/docs/category/layer-2---k3s">Layer 2 - K3s</a><button aria-label="Toggle the collapsible sidebar category &#x27;Layer 2 - K3s&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/hab-guide/docs/category/layer-3---bitcoin">Layer 3 - Bitcoin</a><button aria-label="Toggle the collapsible sidebar category &#x27;Layer 3 - Bitcoin&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/hab-guide/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/hab-guide/docs/category/layer-1---hosts"><span itemprop="name">Layer 1 - Hosts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Ansible</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Ansible</h1><p>The word &quot;ansible&quot; <a href="https://en.wikipedia.org/wiki/Ansible" target="_blank" rel="noopener noreferrer">comes from</a> 1960s
sci-fi for a device which can communicate faster than the speed of light over
unlimited distances. Though Ansible, the software, certainly does not move at
faster than light speed, if you have ever provisioned multiple computers at the
same time, Ansible fully lives up to the namesake.</p><p>Ansible is a suite of open source software tools for configuring remote systems
via the
<a href="https://en.wikipedia.org/wiki/Infrastructure_as_code" target="_blank" rel="noopener noreferrer">Infrastructure as Code</a>
paradigm. Or, rather, this is a fancy way of saying &quot;it&#x27;s a program that runs
scripts on other machines and offers certain guarantees when doing so&quot;. One of
the big guarantees is idempotence, which you just saw in
<a href="/hab-guide/docs/l1-hosts/control-prep#indempotent-ness">Control Prep</a>. The basic upside
of Ansible is that you can use code to define the state of a machine, and that
code can be applied to many machines. As such, you only need to execute a
command one time, and it can completely change the state of multiple machines.</p><p>Generally speaking, Ansible works by ssh-ing into a remote host, and begins
executing commands, such as, <code>copy a file to the host</code>, <code>create a new user</code>,
<code>close this port</code>, etc.</p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Warning: READ THE CODE BEFORE EXECUTION</div><div class="admonitionContent_S0QG"><p>Ansible is capable of executing <strong>ANY</strong> arbitrary code on <strong>ANY</strong> host in your
network that it can log into. As such, one should <em>always</em> read the code to be
executed before running an Ansible command. Luckily for us, it is also a part of
Ansible framework to explicitly describe, in English, every command to be
executed, and print out that description when it is executing.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ansible-config">Ansible Config<a class="hash-link" href="#ansible-config" title="Direct link to heading">​</a></h2><p>Because of the above warning, before we run any command, we should be familiar
with the config file we will be using for Ansible. It is in the root directory
of the <code>gildedpleb/hab-plays</code> repo. Navigate to where you cloned that repo now.
You will need to be in the root of that directly for ALL Ansible commands in
this guide. If you simply cloned it earlier and have not moved directories in
your terminal, you should be able to get there with:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> hab-plays</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s take a look at the config, it should match this:</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">hab-plays/ansible.cfg</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[defaults]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inventory = ~/.HAB/inventory/hosts                    ; Location of the hosts file we will use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">host_key_checking = False                             ; This affects ~.ssh/known_hosts and helps aleviate erronious warnings when on a LAN network with DNS resolved hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vault_password_file = ~/.HAB/.ansible_vault_access    ; Location of the password file we created already</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">forks = 7                                             ; The number of concurent threads that can run at the same time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gathering = smart                                     ; Reduces the amount of fact gathering durring plays that contact the same host more than once</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fact_caching = jsonfile                               ; The file type of the fact gathering cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fact_caching_connection = ~/.HAB/.facts_cache         ; The location of that cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># two hours timeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fact_caching_timeout = 7200                           ; The expiration of that fact gathering cache</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="visually-assert-config-is-correct">Visually Assert Config Is Correct<a class="hash-link" href="#visually-assert-config-is-correct" title="Direct link to heading">​</a></h3><p>To make sure everything is
<a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#avoiding-security-risks-with-ansible-cfg-in-the-current-directory" target="_blank" rel="noopener noreferrer">in working order</a>,
let&#x27;s ask Ansible to dump whatever it thinks the current config is, and it
should match the above:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ansible-config dump --only-changed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should see the following, and it should match the above, no less and no
more:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CACHE_PLUGIN(/Users/&lt;YOU&gt;/&lt;PATH_TO&gt;/hab-plays/ansible.cfg) = jsonfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CACHE_PLUGIN_CONNECTION(/Users/&lt;YOU&gt;/&lt;PATH_TO&gt;/hab-plays/ansible.cfg) = ~/.HAB/.facts_cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CACHE_PLUGIN_TIMEOUT(/Users/&lt;YOU&gt;/&lt;PATH_TO&gt;/hab-plays/ansible.cfg) = 7200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEFAULT_FORKS(/Users/&lt;YOU&gt;/&lt;PATH_TO&gt;/hab-plays/ansible.cfg) = 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEFAULT_GATHERING(/Users/&lt;YOU&gt;/&lt;PATH_TO&gt;/hab-plays/ansible.cfg) = smart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEFAULT_HOST_LIST(/Users/&lt;YOU&gt;/&lt;PATH_TO&gt;/hab-plays/ansible.cfg) = [&#x27;/Users/&lt;YOU&gt;/.HAB/inventory/hosts&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEFAULT_VAULT_PASSWORD_FILE(/Users/&lt;YOU&gt;/&lt;PATH_TO&gt;/hab-plays/ansible.cfg) = /Users/&lt;YOU&gt;/.HAB/.ansible_vault_access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HOST_KEY_CHECKING(/Users/&lt;YOU&gt;/&lt;PATH_TO&gt;/hab-plays/ansible.cfg) = False</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="alter-config">Alter Config<a class="hash-link" href="#alter-config" title="Direct link to heading">​</a></h3><p>You should alter the config to meet your needs best. In particular, you should
change <code>forks</code> to match the number of hosts you have. The PoC has 7 hosts, thus
7 forks, so we can run the same plays at the same time on each host without
waiting for a previous host to finish first.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>the cache</div><div class="admonitionContent_S0QG"><p>Be advised, the cache is a dump of system details about your hosts. After you
run commands, you can view it in plain text at the address above.</p><ol><li>You may want to disable the cash by commenting it out, so that it does not
save all this info to disk. This will cost you playback speed.</li><li>You may want to delete the cache from time to time, you can find it at the
location listed above. Or run the delete command<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf ~/.HAB/.facts_cache</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="first-command">First Command<a class="hash-link" href="#first-command" title="Direct link to heading">​</a></h2><p>We will now execute our first Ansible command to check the validity of a
potential host name.</p><p>Before we run the command, we are going to walk through everything it does, and
thus, how to walk through all Ansible commands. Don&#x27;t run it just yet, but the
command we are going to run is this:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apb Hosts/validate-hostname.yml --extra-vars </span><span class="token string" style="color:#e3116c">&quot;hostName=test1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p><code>apb</code> is the alias for <code>ansible-playbook</code> which we set earlier.
<code>ansible-playbook</code> is the executable for running multiple commands and threads
called &quot;playbooks&quot;.</p></li><li><p><code>Hosts/validate-hostname.yml</code> is the actual code that comprises the command.
It is this:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">hab-plays/Hosts/validate-hostname.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">include_tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tasks/validate</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">host</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above code, we see two things:</p><ul><li><strong>hosts</strong>: where the command should run. In this case, on the machines we
are running the command from, the localhost.</li><li><strong>tasks</strong>: the tasks which are to run on that host. In this case, it is the
tasks located at <code>tasks/validate-host-name.yml</code></li></ul><p>Heading over to <code>tasks/validate-host-name.yml</code> we see this code:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">hab-plays/Hosts/tasks/validate-host-name.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Make sure all characters in hostnames are lowercase alphanumeric &#x27;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&#x27; or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;.&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">assert</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">that</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hostName is match(&#x27;^</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">z0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">z0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">9.</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">z0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">quiet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fail_msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;The node name &#x27;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> hostName </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&#x27; either</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1. Starts or ends with something</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      other than alphanumeric</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 2. Is not all lowercase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> or 3. Includes an</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      invalid character&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Make sure hostnames are less than 253 characters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">assert</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">that</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hostName </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> length &lt; 253</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">quiet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fail_msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;The node name &#x27;{{ hostName }}&#x27; is longer than 253 characters&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Spend a second trying to understand this code. It is fairly generic Ansible
boilerplate for checking if a passed extra variable <code>hostName</code> is up to snuff.
If the tests fail, the fail message is printed.</p></li><li><p>Lastly, in our original command, the <code>--extra-vars &quot;hostName=test1&quot;</code> flag
tells Ansible to set the variable <code>hostName</code> to the text &quot;test1&quot; and make it
available to our script.</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="run-it">Run It<a class="hash-link" href="#run-it" title="Direct link to heading">​</a></h2><p>Replace &quot;test1&quot; with any potential name choice and give it a run. A successful
run should not be dissimilar to this:</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Moving forward, we will be truncating <code>--extra-vars</code> to <code>-e</code>, which is the short
version of that flag.</p></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">% apb Hosts/validate-hostname.yml --extra-vars </span><span class="token string" style="color:#e3116c">&quot;hostName=test1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">localhost</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ***********************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Gathering Facts</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> *****************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">localhost</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">include_tasks</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> *******************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">included: /Users/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">YOU</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">PATH_TO</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/hab-plays/Hosts/tasks/validate-host-name.yml </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Make sure all characters </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> hostnames are lowercase alphanumeric </span><span class="token string" style="color:#e3116c">&#x27;-&#x27;</span><span class="token plain"> or </span><span class="token string" style="color:#e3116c">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> *****************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">localhost</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Make sure hostnames are </span><span class="token function" style="color:#d73a49">less</span><span class="token plain"> than </span><span class="token number" style="color:#36acaa">253</span><span class="token plain"> characters</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ********************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">localhost</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY RECAP *****************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">localhost                  </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ok</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">changed</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">unreachable</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">failed</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">skipped</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">rescued</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">ignored</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And a failure run might look like this:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">% apb Hosts/validate-hostname.yml --extra-vars </span><span class="token string" style="color:#e3116c">&quot;hostName=???&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">localhost</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ***********************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">include_tasks</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> *******************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">included: /Users/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">YOU</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">PATH_TO</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/hab-plays/Hosts/tasks/validate-host-name.yml </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Make sure all characters </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> hostnames are lowercase alphanumeric </span><span class="token string" style="color:#e3116c">&#x27;-&#x27;</span><span class="token plain"> or </span><span class="token string" style="color:#e3116c">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> *****************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fatal: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">localhost</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: FAILED</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;assertion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hostName is match(&#x27;^[a-z0-9][a-z0-9.-]{0,}[a-z0-9]$&#x27;)&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;changed&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> false, </span><span class="token string" style="color:#e3116c">&quot;evaluated_to&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> false, </span><span class="token string" style="color:#e3116c">&quot;msg&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;The node name &#x27;???&#x27; either: 1. Starts or ends with something other than alphanumeric, 2. Is not all lowercase, or 3. Includes an invalid character&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY RECAP *****************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">localhost                  </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ok</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">changed</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">unreachable</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">failed</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">skipped</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">rescued</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">ignored</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Yes, this is Overkill</div><div class="admonitionContent_S0QG"><p>In case you were wondering, yes, it is complete overkill to use Ansible to check
a words&#x27; validity when any human can read for these very easy checks, or a
simple command can do it. In our case, we need this check in Ansible for another
script, to fool-proof the system, so we might as well make use of it twice.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-is-ansible-doing-here">What is Ansible Doing Here?<a class="hash-link" href="#what-is-ansible-doing-here" title="Direct link to heading">​</a></h2><p>Right off the bat, you should notice that Ansible is following the directions
exactly as specified in the <code>.yml</code> file and reporting everything it&#x27;s doing.
First, Ansible gets the list of hosts and gathers information about them. Then,
it gets the tasks and begins execution. You will notice it did not do any fact
gathering in the fail case above, that is thanks to the cache. Only once we get
into more complex Ansible commands, will you really see where Ansible shines.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Atypical Ansible Structuring</div><div class="admonitionContent_S0QG"><p>If you are familiar with Ansible, you will immediately notice that we are not
using <code>roles</code>, <code>ansible-galaxy</code> and a host of other best practices and community
resources that Ansible scripts are typically designed around.</p><p>This is intentional.</p><p>For instance, the <code>role</code> pattern, though undoubtedly useful in commercial host
provisioning with large experienced teams and thousands of computers, is opaque
to navigate and disorienting to read. Having to open up multiple files and
directories to find <code>variables</code> and figure out how they connect with other
<code>tasks</code> in yet other files and folders is indirection and does not make for
readable or digestible code, which is a first priority for this guide. We are
using Ansible as a beginner would use it and reason with it because the
expectation is that the audience is indeed beginners.</p></div></div><p>Now that we have some validated names, and a brief intro on Ansible, let&#x27;s start
networking our hosts together.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/GildedPleb/hab-guide/edit/master/website/docs/l1-hosts/ansible.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-01-06T06:59:33.000Z">Jan 6, 2023</time></b> by <b>GildedPleb</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/hab-guide/docs/l1-hosts/host-naming"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Host Naming</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/hab-guide/docs/l1-hosts/networking"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Stand-up Raw Hosts</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ansible-config" class="table-of-contents__link toc-highlight">Ansible Config</a><ul><li><a href="#visually-assert-config-is-correct" class="table-of-contents__link toc-highlight">Visually Assert Config Is Correct</a></li><li><a href="#alter-config" class="table-of-contents__link toc-highlight">Alter Config</a></li></ul></li><li><a href="#first-command" class="table-of-contents__link toc-highlight">First Command</a></li><li><a href="#run-it" class="table-of-contents__link toc-highlight">Run It</a></li><li><a href="#what-is-ansible-doing-here" class="table-of-contents__link toc-highlight">What is Ansible Doing Here?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Techical Designs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/GildedPleb/hab-guide" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tutorial on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/GildedPleb/hab-plays" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ansible Plays<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/GildedPleb/helm-charts/blob/master/charts/hab" target="_blank" rel="noopener noreferrer" class="footer__link-item">Helm Chart<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/gildedpleb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/GildedPleb" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Essential Qs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/hab-guide/docs/Introduction/who">Who?</a></li><li class="footer__item"><a class="footer__link-item" href="/hab-guide/docs/Introduction/what">What?</a></li><li class="footer__item"><a class="footer__link-item" href="/hab-guide/why">Why?</a></li><li class="footer__item"><a class="footer__link-item" href="/hab-guide/how">How?</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/hab-guide/poc">Proof of Concept</a></li><li class="footer__item"><a class="footer__link-item" href="/hab-guide/support">Support</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/hab-guide/img/ionico.png" alt="HAB Node" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/hab-guide/img/ionico.png" alt="HAB Node" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2023 HAB Node Project.</div></div></div></footer></div>
<script src="/hab-guide/assets/js/runtime~main.cfdfe1a9.js"></script>
<script src="/hab-guide/assets/js/main.578d3d2c.js"></script>
</body>
</html>