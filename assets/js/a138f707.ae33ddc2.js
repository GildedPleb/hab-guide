"use strict";(self.webpackChunkhab_guide=self.webpackChunkhab_guide||[]).push([[5304],{3905:(e,t,n)=>{n.d(t,{Zo:()=>h,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},h=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),p=d(n),u=r,m=p["".concat(l,".").concat(u)]||p[u]||c[u]||o;return n?a.createElement(m,i(i({ref:t},h),{},{components:n})):a.createElement(m,i({ref:t},h))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var d=2;d<o;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9172:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var a=n(7462),r=(n(7294),n(3905));const o={title:"HAB Node Proof of Concept"},i="Proof of Concept",s={type:"mdx",permalink:"/hab-guide/poc",source:"@site/src/pages/poc.md",title:"HAB Node Proof of Concept",description:"Technical design considerations and specifications for the Proof of Concept",frontMatter:{title:"HAB Node Proof of Concept"}},l=[{value:"Name",id:"name",level:2},{value:"Design Considerations",id:"design-considerations",level:2},{value:"Constraints",id:"constraints",level:3},{value:"Cost",id:"cost",level:3},{value:"Power",id:"power",level:3},{value:"Noise",id:"noise",level:3},{value:"Looks",id:"looks",level:3},{value:"Hardware",id:"hardware",level:2},{value:"Cluster Totals",id:"cluster-totals",level:3},{value:"Comparison",id:"comparison",level:3},{value:"Single Points of Failure",id:"single-points-of-failure",level:2},{value:"Eliminated",id:"eliminated",level:3},{value:"Remaining",id:"remaining",level:3},{value:"Uptime",id:"uptime",level:2},{value:"Performance",id:"performance",level:2},{value:"Lessons Learned",id:"lessons-learned",level:2},{value:"Cluster Crash",id:"cluster-crash",level:3},{value:"Hard Drives",id:"hard-drives",level:3},{value:"Host Diversification",id:"host-diversification",level:3},{value:"Conclusion",id:"conclusion",level:2},{value:"Summary",id:"summary",level:3},{value:"Going Forward",id:"going-forward",level:3}],d={toc:l};function h(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"proof-of-concept"},"Proof of Concept"),(0,r.kt)("p",null,"Technical design considerations and specifications for the Proof of Concept\nHighly Available Bitcoin Node featured herein."),(0,r.kt)("p",null,"The Ionico Base Node: ",(0,r.kt)("img",{alt:"HAB Node White Backdrop",src:n(5208).Z,width:"2003",height:"1427"})),(0,r.kt)("h2",{id:"name"},"Name"),(0,r.kt)("p",null,"It is named after\n",(0,r.kt)("a",{parentName:"p",href:"https://www.thoughtco.com/what-is-an-ionic-column-177515"},"Ionic Columns"),', not\njust for the essence of the column as vertical blades with alternating convex\nand concave space, but, in particular, for the base which is "stacked disks".\nAnd, because of course, pillars are the quintessential symbol of Western\nCivilization.'),(0,r.kt)("h2",{id:"design-considerations"},"Design Considerations"),(0,r.kt)("p",null,"The only real purpose of this project was that it needed to be a functional\nBitcoin node which was highly available, as outlined in the docs elsewhere.\nEverything else came in second place, including all higher layer services (like\nlightning, which was not implemented for this PoC)."),(0,r.kt)("h3",{id:"constraints"},"Constraints"),(0,r.kt)("p",null,"The largest ",(0,r.kt)("em",{parentName:"p"},"guiding")," constraints when designing this node were these:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"It should be cheaper than a high-end laptop"),(0,r.kt)("li",{parentName:"ol"},"It should be quiet enough for running in a room with humans"),(0,r.kt)("li",{parentName:"ol"},"It should look awesome")),(0,r.kt)("h3",{id:"cost"},"Cost"),(0,r.kt)("p",null,"At no point were we worried about exceeding the cost constraint. It should not\ncome as a surprise to anyone that the second you leave the walled garden of,\nsay, Apple, everything gets considerably cheaper (if perhaps not the most\ncutting edge or beautiful)."),(0,r.kt)("h3",{id:"power"},"Power"),(0,r.kt)("p",null,"Managing 7x clunky power cables would have made this project unmanageable for\nconsumer bare-metal, and it would have made it look like a rats nest. Power Over\nEthernet (PoE) hats were deployed for the Raspberry Pi nodes bringing total\npower bricks down to three, and massively reducing cabling."),(0,r.kt)("p",null,"Additionally, many USB 3.1 SSD hard drives (especially in higher TB ranges) draw\ntoo much power from a Raspberry Pi, and are thus unstable and need external\npower sources\u2014which, again, was a no-go for this build. Samsung's 2 TB external\ndrive was the only SSD hard drive solutions found (at build time) after\nconsiderable research and testing."),(0,r.kt)("h3",{id:"noise"},"Noise"),(0,r.kt)("p",null,"Consumer deployment requires ultra quiet operation. Even the world's quietest\nactive cooling system for an RPi can become problematic when multiplied by five.\nNot to mention moving parts are far more prone to breaking."),(0,r.kt)("p",null,"Passive cooling for the Raspberry Pis and open casing were used to facilitate\nair flow. Though not photographed, the node lives on an open-faced rack that\nprovides vertical and unobstructed airflow between the pi hosts. In extreme\nconditions, a standard desk or box fan can be applied externally to the entire\nunderside of the node, as the air has a clean exit upward, dramatically reducing\ntemps."),(0,r.kt)("p",null,"Our hats are off to ",(0,r.kt)("a",{parentName:"p",href:"https://geekworm.com/"},"Geekworm")," for designing a PoE hat\nthat fits with a passive cooling case. Pun intended."),(0,r.kt)("p",null,"This node is quieter than a mouse."),(0,r.kt)("h3",{id:"looks"},"Looks"),(0,r.kt)("p",null,"An apropos mix of Borg, Nolan Batman, Gunmetal and Light:\n",(0,r.kt)("img",{alt:"HAB Node on Blue Background",src:n(4077).Z,width:"1280",height:"960"})),(0,r.kt)("h2",{id:"hardware"},"Hardware"),(0,r.kt)("admonition",{title:"Warning: Fiat Prices Ahead",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"This hardware was purchased at variable prices (especially for the 5x items)\nmostly over the course of 6 months from Oct '21 to April '22 while testing and\nrebuilding. The prices shown constitute averages, and mostly do not include the\nrapid price rises in consumer electronics caused by fiat currency. In other\nwords, prices you are about to read are practically meaninglessness apart from\ntheir relationship to one another, which itself is wanting.")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Item"),(0,r.kt)("th",{parentName:"tr",align:"right"},"Cost"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Count"),(0,r.kt)("th",{parentName:"tr",align:"right"},"Total"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Raspberry Pi 4 Model B 8 GB RAM, 1.5GHz Quad-core"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$142.99"),(0,r.kt)("td",{parentName:"tr",align:"center"},"5"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$714.95")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Samsung T5 Portable SSD 2 TB, MU-PA2T0B/AM"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$219.95"),(0,r.kt)("td",{parentName:"tr",align:"center"},"5"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$1,099.75")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1 inch USB-C Male to USB-3.0 Male Adapter"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$7.99"),(0,r.kt)("td",{parentName:"tr",align:"center"},"5"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$39.95")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Geekworm for Raspberry Pi 4 Model B/Pi 3 Model B+, Raspberry Pi Power Over Ethernet (PoE+) X765 PoE HAT 802.3at/802.3af 5Vdc"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$34.99"),(0,r.kt)("td",{parentName:"tr",align:"center"},"5"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$174.95")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Geekworm Raspberry Pi 4 Model B CNC Ultra-Thin Aluminum Alloy Metal Passive Cooling Case"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$26.99"),(0,r.kt)("td",{parentName:"tr",align:"center"},"5"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$134.95")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Monoprice 134211 Cat6 Ethernet Patch Cable, .5ft, Black, Stranded, 550MHz, UTP, Pure Bare Copper Wire, 32AWG, Micro SlimRun Series"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$1.79"),(0,r.kt)("td",{parentName:"tr",align:"center"},"5"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$10.74")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"HVAZI 240pcs M2.5 Nylon Hex Spacer Standoffs Screws Nuts Assortment Kit, Male-Female, Black"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$11.99"),(0,r.kt)("td",{parentName:"tr",align:"center"},"1"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$11.99")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Intel NUC 11, Core i3-1115G4 2-Core, 3.0 GHz\u20134.1 GHz Turbo, NUC11PAHi3"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$395.00"),(0,r.kt)("td",{parentName:"tr",align:"center"},"2"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$790.00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Samsung 970 EVO Plus SSD 2 TB NVMe M.2 Internal Solid State Hard Drive w/ V-NAND, MZ-V7S2T0B/AM"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$209.99"),(0,r.kt)("td",{parentName:"tr",align:"center"},"2"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$419.98")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"32 GB DDR4 3200MHz PC4-25600 1.2V 2Rx8 260-Pin SODIMM Laptop RAM, M471A4G43AB1-CWE"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$138.95"),(0,r.kt)("td",{parentName:"tr",align:"center"},"4"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$555.80")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Monoprice 107687 3ft 18AWG Grounded AC Power Cord, 10A (NEMA 5-15P to IEC-320-C5)"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$8.95"),(0,r.kt)("td",{parentName:"tr",align:"center"},"2"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$17.90")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Cat6 Ethernet Cable 1ft Black, 6 Pack, flat, snagless Rj45 Connectors"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$13.99"),(0,r.kt)("td",{parentName:"tr",align:"center"},"1"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$13.99")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Netgear 8-Port Gigabit Ethernet Unmanaged PoE Switch w/ 8 x PoE+ @ 123W, GS108PP"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$109.99"),(0,r.kt)("td",{parentName:"tr",align:"center"},"1"),(0,r.kt)("td",{parentName:"tr",align:"right"},"$109.99")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:"right"}),(0,r.kt)("td",{parentName:"tr",align:"center"},(0,r.kt)("strong",{parentName:"td"},"Total")),(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"$4,094.94"))))),(0,r.kt)("h3",{id:"cluster-totals"},"Cluster Totals"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"center"},"Memory"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Storage"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Cores"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"168 GB"),(0,r.kt)("td",{parentName:"tr",align:"center"},"14 TB"),(0,r.kt)("td",{parentName:"tr",align:"center"},"24")))),(0,r.kt)("h3",{id:"comparison"},"Comparison"),(0,r.kt)("p",null,"As of Dec 2022, a maxed out 16\u2011inch MacBook Pro Apple M1 Max chip:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"center"},"Memory"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Storage"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Cores"),(0,r.kt)("th",{parentName:"tr",align:"right"},"Total Cost"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"64 GB"),(0,r.kt)("td",{parentName:"tr",align:"center"},"8 TB"),(0,r.kt)("td",{parentName:"tr",align:"center"},"58"),(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"$6,099.00"))))),(0,r.kt)("p",null,"All this for less than an Apple MacBook\n",(0,r.kt)("img",{alt:"HAB Node Black Backdrop",src:n(701).Z,width:"2049",height:"1536"})),(0,r.kt)("h2",{id:"single-points-of-failure"},"Single Points of Failure"),(0,r.kt)("p",null,"The focus of this build, again, was to present a Proof of Concept, it was to\nprove that we ",(0,r.kt)("em",{parentName:"p"},"could")," eliminate choke-points, but not, necessarily, to eliminate\nevery single one."),(0,r.kt)("h3",{id:"eliminated"},"Eliminated"),(0,r.kt)("p",null,"That said, many have been eliminated. Most notably:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Hardware Failure:")," We have eliminated the most problematic node SPF as it\nalmost for sure exists for almost every current self-hosted bitcoin node\noperator: hard drive or other hardware failure."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Dependency Tree:")," Apart from this, it is also worth mentioning that\nKubernetes itself can run in HA mode, meaning there are at least 3 master\nhosts (or master nodes in k8s terminology): 2 pis, and 1 NUC. As such, we have\neliminated a key SPF in a dependency while introducing said dependency."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Implementation/Versioning Risk:")," Lastly, we have eliminated bitcoin\nimplementation and versioning choke points, which should be a key\nconsideration for all pleb operators who can not code for themselves.")),(0,r.kt)("p",null,"Not featured, we have put this node behind a pre-existing UPS that was available\nto us, as power in our area has a tendency to flicker. This gives the node\nlimited power redundancy for roughly 1 hour, which is far in excess of perceived\nrisk."),(0,r.kt)("h3",{id:"remaining"},"Remaining"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Geographic Location:")," Because this node is designed with a Hydra Option in\nmind, it has the ability to be geographically dispersed. As pictured, this is\nobviously not employed. But hey, it makes the pictures better! A first order\nroadmap item is to get a node host in the cloud, which would remove this SPF."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Router:")," The router used for this node (a pfSense box) gives many options\nfor removing SPFs in internet provider, VPNs, and micro-geo. However, only one\nrouter is serving this node, which itself is an SPF. Multiple routers would\nneed to be introduced and networked together at different locations to fight\nthis risk."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Internet Provider:")," It is worth calling out again, that this node is only\nserved by one internet provider. The option exists to add redundancy here,\nboth with satellite (Bitcoin Satellite) and cell via the pfSense box.\nAdditionally, RPis can employ cell hats.")),(0,r.kt)("h2",{id:"uptime"},"Uptime"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Uptime",src:n(3812).Z,width:"926",height:"208"})),(0,r.kt)("p",null,"As you can see, 169 days of uptime on the first build is great! However, shortly\nafter this screenshot was taken, the entire cluster crashed."),(0,r.kt)("admonition",{title:"Note on Cluster Resource Allocations",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"As you have probably noticed, bitcoind was only running on 3 off 7 nodes. This\nfirst build also included a bcoin instance, a non-clustered bitcoind instance, a\nbtcd instance, and 1 node reserved for N+1. Both btcd and bcoin ran into\nreliability issues over the same time frame, as expected, and entered crash loop\nbackoff regularly."),(0,r.kt)("p",{parentName:"admonition"},"The standalone bitcoind instance ran on one of the NUCs and was used for\nperformance testing. Thus, it did not accurately track uptime at all.")),(0,r.kt)("h2",{id:"performance"},"Performance"),(0,r.kt)("p",null,"Because of Raspberry Pi limitations, it became clear that the NUCs needed to\novercompensate, especially with regard to RAM. Both NUCs have max RAM at 64 GB,\nallowing them to sync the bitcoin blockchain from scratch without dumping the\ncache. This, increasingly, is the single most important factor for node sync."),(0,r.kt)("p",null,"The NUCs can sync bitcoin core in about 8 hours on ultra basic 200 Mbps\ninternet."),(0,r.kt)("p",null,"If you are reading this, you are probably already aware of Raspberry Pi Node\nsync times (or really, any device with less than say, 30 GB of available RAM for\nthe db cache).",(0,r.kt)("img",{alt:"HAB Node vertical black and white",src:n(748).Z,width:"960",height:"1280"})),(0,r.kt)("h2",{id:"lessons-learned"},"Lessons Learned"),(0,r.kt)("h3",{id:"cluster-crash"},"Cluster Crash"),(0,r.kt)("p",null,"The cluster crashed shortly after reaching 6 months of uptime because the\nSoftware Update Controller (SUC) updated k3s, and Longhorn, which releases on a\ndifferent schedule, became reliant on\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/longhorn/longhorn/issues/4003"},"deprecated resources"),". The\nSUC truly lived up to its abbreviated name! /s."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Ways Forward:")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Remove the reliance on Longhorn - Workable, as it is only minimally needed,\nand removes a dependency, which is always good."),(0,r.kt)("li",{parentName:"ol"},"Remove the SUC - Workable. However, this means more manual maintenance."),(0,r.kt)("li",{parentName:"ol"},"Alter how aggressive the SUC is - Workable, and most amicable way forward.\nPresently, it targets ",(0,r.kt)("inlineCode",{parentName:"li"},"latest"),"."),(0,r.kt)("li",{parentName:"ol"},"Remove both - Workable. Both can be thought of as non-essential auxiliary\nfeatures, but they do make life easier, for the most part. More discussion\nhere is needed."),(0,r.kt)("li",{parentName:"ol"},"Update Longhorn to the patched but unreleased version, which fixes the bug.\nThis was the action we took, as it was the simplest, had community support,\nand the node was fully functional again after only a few hours of downtime.")),(0,r.kt)("p",null,"Thankfully, this was a nonpublic beta version for this very reason. And should\nnot have issues once\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/longhorn/longhorn/milestone/33"},"Longhorn 1.4")," is released\nafter December 30, 2022. But it does bring to light the difficulty of\nintroducing dependencies at the Live K3s level. Baby steps."),(0,r.kt)("h3",{id:"hard-drives"},"Hard Drives"),(0,r.kt)("p",null,"Surprisingly for us, but perhaps unsurprisingly for others, hard drives were a\nproblematic focal point in this build. The original plan was to employ simple\nUSB stick hard drives as they are now very affordable and in the +1 TB range,\nand plug them into pis. What we failed to account for was just how much power\nthese tiny hard drives need on Raspberry Pis, how much hard drive space was\nactually needed in our block storage solution, Longhorn, and how performant they\nneeded to be. Once we realized the USB sticks were out because size,\nperformance, and power, we investigated NVMe USB adapters, but came to find out\nthat they were out because of power. After many purchases and returns, we\nfinally realized we needed to ride the minimums of acceptable performance just\nto get the least power and most space. This, in turn, pushed us toward adding\nNUCs to the cluster, which was not a part of the original design."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Ways Forward:")),(0,r.kt)("p",null,"The way forward here is simple: front load more research into hardware and\nsoftware specifications and requirements. At the end of the day, Raspberry Pis\nare cool and all, but until Pi 5 is released, and we get to see the specs, we\nwould not recommend anyone to buy additional Raspberry Pis to incorporate into a\nHAB Node. If you have pis, use then, but if you are going to buy hardware, buy\nhardware which has better performance extensibility than Pi's."),(0,r.kt)("h3",{id:"host-diversification"},"Host Diversification"),(0,r.kt)("p",null,"We placed a high premium on aesthetics for this node too early in the build. The\npictures do look very pretty, however, as we have come to realize, no HAB Node\nshould have 5, or even 3, or maybe even 2 of the same computer host. The problem\nhere is that it can introduce perverse incentives for any single manufacture,\nvia economies of scale. Say, if someone realizes that the Raspberry Pi\nFoundation is primarily manufacturing HAB Nodes, and those RPi hosts constitute\na majority of hosts in HAB Nodes. This introduces a hardware single-point of\nfailure if one wishes to attack HAB Nodes and was recently and briefly outlined\nby ",(0,r.kt)("a",{parentName:"p",href:"https://twitter.com/provoost"},"Sjors"),", a core contributor, on\n",(0,r.kt)("a",{parentName:"p",href:"https://podcasts.apple.com/us/podcast/383-bitcoin-a-work-in-progress-with-sjors-provoost/id1292381204?i=1000590398619"},"TFTC"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Ways Forward:")),(0,r.kt)("p",null,"Employ as many manufacturers as possible, where none can materially impact your\nnode's threat model. E.g. if you have N+1, you can afford to have 1 of each type\nof host, if you have N+2, you can afford to have 2 of each type of host, but you\nshould never have a single type of host that constitutes a majority of hosts.\nObviously, moving above 2x one type of host, without letting that host become a\nmajority, while also maintaining N+X, can completely balloon the node cost."),(0,r.kt)("p",null,"Additionally, it might be worth exploring getting more unique nodes, and turning\nthe Pis into routers so that each Pi router can have one node behind it. Each of\nthe Pi routers then live at various dispersed locations and are networked\ntogether via a VPN or TOR."),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"The inimitable Ionico Base node, but in candy apple red:\n",(0,r.kt)("img",{alt:"Node with red background",src:n(1743).Z,width:"2049",height:"1536"})," Undoubtedly, there\nare ",(0,r.kt)("em",{parentName:"p"},"better")," self-hosted solutions out there, and we look forward to seeing ones\nthat exceed this project!"),(0,r.kt)("h3",{id:"summary"},"Summary"),(0,r.kt)("p",null,"We have built a variously defined Highly Available Bitcoin Node. Though a few\nsingle points of failure remain, we have eliminated a great deal of the most\npressing ones, and have retained an uptime of +169 days, while spinning up and\ntearing down many other nodes running on the same cluster. In short, we met the\ngoals of creating a quiet, self-hosted HA Bitcoin node, under budget, that looks\ngreat."),(0,r.kt)("p",null,"Many lessons where learned along the way, and this node took many rounds of\nbuilding and tearing down to get right: 6 months of active free-time/part-time\ndevelopment, and 6 months of passive monitoring. To complete this project, it\nwas essential to have experience in networking, pfSense, Kubernetes, Helm,\nSprig, YAML, and Ansible. We hope that in the guide, the essential lessons have\nbeen passed on while abstracting away as much as possible to make the process of\nbuilding more of these nodes palatable for more people."),(0,r.kt)("h3",{id:"going-forward"},"Going Forward"),(0,r.kt)("p",null,"As you are probably well aware, the resources in this node have gone largely\nunused, there is much work still to be done, and many verticals to explore. At\nthe end of the day, a k8s node can run, well, anything. With Bitcoin as the\neconomic impetus for keeping uptime high, this opens the door for all sorts of\nHA services for self-hosted individuals. Indeed, a HAB node provides the path\nfor all such services to becoming reliably income producing without sacrifices\nto privacy, autonomy, or sovereignty. HAB Nodes empower sovereign plebs at the\nedge with the most advanced datacenter tech which was formerly only meaningful\nin the centralized cloud."),(0,r.kt)("p",null,"This Bitcoin node started as an idea in 2019 with one Raspberry Pi (now ",(0,r.kt)("inlineCode",{parentName:"p"},"pi5"),",\nthe Pi closest to the NUCs in the photos on this page), an old hard drive, a\nlove for Bitcoin, and the knowledge that\n",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/blog/2015/12/creating-raspberry-pi-cluster-running/"},"k8s could run on a Pi cluster"),".\nBut who knew how to combine the lot? When we started realizing in mid 2021 that\nwe could build a Highly Available node, from skills gleaned in professional full\nstack development, the project became an itch that must be scratched. After a\nfew months of planning and research, we started building the Ionico Base node in\nOct '21 with the addition of 4 new Raspberry Pis, and 5 USB hard drives (which\ndid not make it into the final build for reasons we\n",(0,r.kt)("a",{parentName:"p",href:"/docs/l1-hosts/hardware"},"discuss elsewhere"),")."),(0,r.kt)("p",null,"When we started, self-hosted Kubernetes clusters where still a fairly niche\nhobby project, it was not easy finding resources to meet the particular needs of\nK8s on Pi's, none-the-less clustering Bitcoin Nodes, but a survey of 2022 has\nrevealed that these types of guides and projects have ",(0,r.kt)("em",{parentName:"p"},"exploded")," in popularity.\nThis is an encouraging\nsign.",(0,r.kt)("img",{alt:"HAB Node vertical black and white",src:n(9676).Z,width:"1536",height:"2049"})),(0,r.kt)("p",null,"Hopefully no other HAB Nodes look like the Ionico Base Node (",(0,r.kt)("em",{parentName:"p"},"or costs as\nmuch"),"), indeed, this node is not without its problems, but a HAB Node, in all\nits variations, is the only way forward we are aware of that has the ability to\nmeet HA uptime standards of the cloud, remove as many single-points-of-failure\nas possible, and thus has the ability to deliver reliable ",(0,r.kt)("em",{parentName:"p"},"satoshi income\nstreams")," on Lighting and other higher layers, without sacrificing privacy,\nautonomy, freedom, rights, censorship, or human flourishing. We fully believe\nthat this version of self-hosted is the future, indeed, it must be for Bitcoin\nand humanity to flourish:"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},'"We cannot expect governments, corporations, or other large, faceless\norganizations to grant us privacy out of their beneficence."'),(0,r.kt)("p",{parentName:"blockquote"},"-"," Eric Hughes, A Cypherpunk's Manifesto, 1993")),(0,r.kt)("p",null,"What is more, we hope that this PoC Node, this guide, and the code we have\nwritten herein, helps make that reality."),(0,r.kt)("hr",null),(0,r.kt)("p",null,"For a more in depth explanation on why this is important, see ",(0,r.kt)("a",{parentName:"p",href:"/why"},"Why?")))}h.isMDXComponent=!0},1743:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/feature_aesthetics_node-36291b2ff1cbd1d893d80c6c5e7fef3b.png"},701:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/fin_black-a0d8af89a944d08d99ef87b09feccd5b.png"},9676:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/intro_power-da45efe83fbcb2a69e8bfa069b099cd4.png"},4077:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/poc_blue_flat-2154892173e2d4b7f21a2e81a7b53555.png"},748:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/poc_tower-8fb403767b821907986ed6c80836a1fe.png"},3812:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/uptime-8418eb7f7191297ceab2b3c2ff068b5d.png"},5208:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/white_profile-3297e9b2693e0e136f435112eacf21a9.JPG"}}]);