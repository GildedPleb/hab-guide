"use strict";(self.webpackChunkhab_guide=self.webpackChunkhab_guide||[]).push([[3056],{3905:(e,t,n)=>{n.d(t,{Zo:()=>h,kt:()=>m});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),d=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},h=function(e){var t=d(e.components);return o.createElement(s.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),p=d(n),u=a,m=p["".concat(s,".").concat(u)]||p[u]||c[u]||i;return n?o.createElement(m,r(r({ref:t},h),{},{components:n})):o.createElement(m,r({ref:t},h))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,r[1]=l;for(var d=2;d<i;d++)r[d]=n[d];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7179:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var o=n(7462),a=(n(7294),n(3905));const i={sidebar_position:4},r="Design Considerations",l={unversionedId:"Introduction/design",id:"Introduction/design",title:"Design Considerations",description:"Vanilla Goals",source:"@site/docs/Introduction/design.md",sourceDirName:"Introduction",slug:"/Introduction/design",permalink:"/hab-guide/docs/Introduction/design",draft:!1,editUrl:"https://github.com/GildedPleb/hab-guide/edit/master/website/docs/Introduction/design.md",tags:[],version:"current",lastUpdatedBy:"GildedPleb",lastUpdatedAt:1672810679,formattedLastUpdatedAt:"Jan 4, 2023",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"What Will We Do",permalink:"/hab-guide/docs/Introduction/what"},next:{title:"Practical Considerations",permalink:"/hab-guide/docs/Introduction/practical"}},s={},d=[{value:"Vanilla Goals",id:"vanilla-goals",level:2},{value:"Known Threat Elimination",id:"known-threat-elimination",level:3},{value:"Role Definition",id:"role-definition",level:3},{value:"Bitcoin Specific Goals",id:"bitcoin-specific-goals",level:2},{value:"Decentralizing Resources: Hydra Option",id:"decentralizing-resources-hydra-option",level:3},{value:"No Hydra Option? No problem.",id:"no-hydra-option-no-problem",level:3},{value:"No pre-packaged HAB Node: Aesthetic Option",id:"no-pre-packaged-hab-node-aesthetic-option",level:3},{value:"Your Node",id:"your-node",level:2}],h={toc:d};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"design-considerations"},"Design Considerations"),(0,a.kt)("h2",{id:"vanilla-goals"},"Vanilla Goals"),(0,a.kt)("p",null,"In pursuit of a HAB node, a few high level goals first come to mind. These goals\nare not necessarily specific to Bitcoin, but are goals which would apply to any\nHA system."),(0,a.kt)("h3",{id:"known-threat-elimination"},"Known Threat Elimination"),(0,a.kt)("p",null,"In ",(0,a.kt)("a",{parentName:"p",href:"/why"},"Why?"),' we define the following as "known threats". In particular, the\nnode needs to be designed such that it has the option to ',(0,a.kt)("strong",{parentName:"p"},"NOT")," be reliant on:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"One single computer"),(0,a.kt)("li",{parentName:"ol"},"One single internet source"),(0,a.kt)("li",{parentName:"ol"},"One single power source"),(0,a.kt)("li",{parentName:"ol"},"One single bitcoin code repo"),(0,a.kt)("li",{parentName:"ol"},"One single bitcoin release"),(0,a.kt)("li",{parentName:"ol"},"One single physical location"),(0,a.kt)("li",{parentName:"ol"},"One single supply chain"),(0,a.kt)("li",{parentName:"ol"},"Etc")),(0,a.kt)("p",null,"Essentially, these are obvious and non-exhaustive single points of failure that\nrunning two or more computers in the cluster mitigates. It is a primary goal in\ndesigning a HAB Node to remove these single points of failure."),(0,a.kt)("h3",{id:"role-definition"},"Role Definition"),(0,a.kt)("p",null,"We should also spend a second discussing\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/ha-topology/"},"host roles"),'\nand how they will affect design. In a basic k8s cluster, there are two types of\nhosts: Leader ("control plain node" in k8s speak) and Worker ("worker node").\nThe leader runs the cluster, the workers run all the apps the cluster runs. A\nleader can also run the apps in the cluster, but a worker can not run the\ncluster. In an HA cluster, which we will build, the only difference is that\nthere are many Leaders, not just one.'),(0,a.kt)("p",null,"Generally speaking, if host resources are practically unlimited, say if you are\nrunning a cluster in GKE, you'd want to separate these two groups. Because we\nwill not be assuming unlimited resources, and because the number of apps and\nservices we will be running won't be commercial scale, we will allow for role\noverlap."),(0,a.kt)("p",null,"In terms of design goals, this presents some challenges and considerations.\nBecause leader nodes should be expected to be pulling double duty, we should\navoid assigning them to weaker hosts in terms of number of cores and available\nRAM. However, to improve Bitcoin performance, we also might want to consider not\nmaking highly performant hosts into leaders either, so we can reserve those\nresources for Bitcoin."),(0,a.kt)("p",null,"Another thing to consider here is that etcd (which runs on Leader hosts) will\nrequire ",(0,a.kt)("em",{parentName:"p"},"a lot")," of write and re-write to the hard drive. As such, it is less\nthan ideal to apply a Leader to a host with a slower, older, and used SSD drive."),(0,a.kt)("p",null,"Additionally, its ",(0,a.kt)("em",{parentName:"p"},"required")," that to run in HA mode, there must be at least 3\nLeaders:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If you only have 3 hosts, then they will all be Leaders, and none of this\nmatters."),(0,a.kt)("li",{parentName:"ul"},"If you have more than 3 hosts, there must always be an uneven number of\nLeaders.")),(0,a.kt)("p",null,"For the ",(0,a.kt)("a",{parentName:"p",href:"/poc"},"Ionico Base Node")," we decided to employ 1 NUC and 2 Raspberry Pi's\nto be leaders, and the rest workers. The justification being, we wanted the\nleadership group to have representation on all hardware types, and to also leave\none NUC free for high performance testing as a worker. All our hard drives were\nnew, so we had little worries there, and we have had no related issues with this\nsetup."),(0,a.kt)("p",null,"With single-points-of-failure and role definitions considered, let's now look at\nhow Bitcoin is peculiar and has at least some other, more difficult realities\nassociated with it which can affect designing for availability."),(0,a.kt)("h2",{id:"bitcoin-specific-goals"},"Bitcoin Specific Goals"),(0,a.kt)("p",null,"As also defined in ",(0,a.kt)("a",{parentName:"p",href:"/why"},"Why?"),', we can think of these as ways to mitigate\n"unknown threats". Here are two Bitcoin specific design considerations that\nshould come fairly easily:'),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"A HAB node should not centralize resources"),(0,a.kt)("li",{parentName:"ol"},"If a HAB node does not have the Hydra Option, it still has options"),(0,a.kt)("li",{parentName:"ol"},"A HAB node should not be a pre-packaged end-consumer product")),(0,a.kt)("p",null,"These considerations are important for both security and functionality."),(0,a.kt)("h3",{id:"decentralizing-resources-hydra-option"},"Decentralizing Resources: Hydra Option"),(0,a.kt)("p",null,"In bitcoin parlance centralization is evil, decentralization is good. Though we\ncould build HAB nodes as $10,000 supercomputers which can only work if all the\nparts operate together as one, it is far better to utilize those resources in\nways that are friendly with decentralizing, or splitting up the node. To address\nthis, the node must be composable (or decomposable). As in, it should be trivial\nfor the node operator to slice off a piece of the node where that slice can\noperate on its own, as its own full node. This serves a few purposes also listed\nin ",(0,a.kt)("a",{parentName:"p",href:"/why#obscure-threat-mitigation--hydra-option"},"Why?"),"."),(0,a.kt)("h3",{id:"no-hydra-option-no-problem"},"No Hydra Option? No problem."),(0,a.kt)("p",null,"The Hydra Option should always be a priority, however, it may simply not be\npractical: if you do not have or can not get multiple 2 TB drives, whatever you\n",(0,a.kt)("em",{parentName:"p"},"can")," get will have to suffice, and you can prune the nodes that will be\nutilizing lower storage hosts. If this is the case for you, keep notes of which\nnodes will need to be which, we will revisit this when we look at Hardware, and\nwhen we get to Layer 3 - Bitcoin. That said, it should still be a priority of\nevery HAB Node to keep as many full copies of the blockchain as possible."),(0,a.kt)("h3",{id:"no-pre-packaged-hab-node-aesthetic-option"},"No pre-packaged HAB Node: Aesthetic Option"),(0,a.kt)("p",null,'Though many excellent companies offer individual Bitcoin nodes as pre-packaged\nproducts which can and should be employed in HAB Clusters, HAB Clusters\nthemselves should seek to diversify hardware, vendors, and supply chain as much\nas possible and avoid cluster-level "ready-made" solutions.'),(0,a.kt)("p",null,"Far from a production-line computer, a HAB node should be the highest caliber\nnode that the node operator can muster, and he should take absolute ownership,\npride, and mastery in his node at the exclusion of what others believe his node\nshould be."),(0,a.kt)("p",null,"In our present moment, it seems as though the best way for HAB Nodes to thrive\nis under a culture of\n",(0,a.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=ljqra3BcqWM"},"extreme ownership")," which might\nmanifest itself as such:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},'The HAB node operator should know how it works, how to build it from scratch,\nhow to take it apart, and how to fix it. And they should be passionate about\nit with finality. "This is my node..."'),(0,a.kt)("li",{parentName:"ol"},"A HAB node should be well-designed. It should fit operator needs and\nresources, it should be carefully scrutinized, secured, organized, and, in\nthe end, closer to being a piece of art than a heap of cables, hodgepodge\nacrylic boxes, loud fans, and blinking lights. The aesthetics of the node\nmatter. Which is why we call this the Aesthetic Option for the purposes of\nthis guide."),(0,a.kt)("li",{parentName:"ol"},"As much as this guide may help a node operator set up a HAB node, we would be\nremiss if all HAB nodes looked exactly like the PoC (indeed they ",(0,a.kt)("em",{parentName:"li"},"shouldn't"),",\nconsidering the ",(0,a.kt)("a",{parentName:"li",href:"/poc#host-diversification"},"lessons learned"),"). The intention\nof this guide is to solve a lot of problems standing in the way of getting\nHAB nodes operational, so that others can focus on solving specific problems\nthat their own needs encounter.")),(0,a.kt)("h2",{id:"your-node"},"Your Node"),(0,a.kt)("p",null,"The following are questions you should ask yourself, and answer, about your HAB\nNode before getting started. Literally write down answers to all of these\nquestions:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"What can I afford?"),(0,a.kt)("li",{parentName:"ol"},"How loud can it be?"),(0,a.kt)("li",{parentName:"ol"},"What will I use for cooling?"),(0,a.kt)("li",{parentName:"ol"},"How will I organize cabling?"),(0,a.kt)("li",{parentName:"ol"},"How will I arrange the hosts?"),(0,a.kt)("li",{parentName:"ol"},"What do I want my node to look like?"),(0,a.kt)("li",{parentName:"ol"},"How will I organize and provide power?"),(0,a.kt)("li",{parentName:"ol"},"Where will I keep all my host computers?"),(0,a.kt)("li",{parentName:"ol"},"What performance goals do I want to hit?"),(0,a.kt)("li",{parentName:"ol"},"What unused hardware can I incorporate?"),(0,a.kt)("li",{parentName:"ol"},"What colors do I want to my node to have?"),(0,a.kt)("li",{parentName:"ol"},"What lights should or should not be visible?"),(0,a.kt)("li",{parentName:"ol"},"What Single Points of Failure can I tolerate?"),(0,a.kt)("li",{parentName:"ol"},"How can I turn this node into a piece of art?"),(0,a.kt)("li",{parentName:"ol"},"How many computers do I want in the node?"),(0,a.kt)("li",{parentName:"ol"},"How many bitcoin instances do I want to run?"),(0,a.kt)("li",{parentName:"ol"},"How many copies of the blockchain can I afford?"),(0,a.kt)("li",{parentName:"ol"},"How much time do I have to work on this project?"),(0,a.kt)("li",{parentName:"ol"},"What small tweaks can I make which could add up?"),(0,a.kt)("li",{parentName:"ol"},"What unused hardware should I avoid incorporating?"),(0,a.kt)("li",{parentName:"ol"},"What Single Points of Failure do I want/need to eliminate?"),(0,a.kt)("li",{parentName:"ol"},"How will I label, name, or identify the hosts and the node itself?"),(0,a.kt)("li",{parentName:"ol"},"Of the above questions, which ones are most and least important to me?"),(0,a.kt)("li",{parentName:"ol"},"Given all my constraints, what ways can I find pride in my node, and how can\nI lean into them?")),(0,a.kt)("p",null,"For example answers to some of these questions, and ideas about how to pursue\nthem, see the ",(0,a.kt)("a",{parentName:"p",href:"/poc"},"PoC"),"."))}p.isMDXComponent=!0}}]);