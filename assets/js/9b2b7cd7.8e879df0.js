"use strict";(self.webpackChunkhab_guide=self.webpackChunkhab_guide||[]).push([[6456],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>c});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=d(n),m=r,c=u["".concat(l,".").concat(m)]||u[m]||h[m]||o;return n?a.createElement(c,s(s({ref:t},p),{},{components:n})):a.createElement(c,s({ref:t},p))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"==typeof e?e:r,s[1]=i;for(var d=2;d<o;d++)s[d]=n[d];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},112:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var a=n(7462),r=(n(7294),n(3905));const o={sidebar_position:6},s="Stand-up Raw Hosts",i={unversionedId:"l1-hosts/networking",id:"l1-hosts/networking",title:"Stand-up Raw Hosts",description:"Networking",source:"@site/docs/l1-hosts/networking.md",sourceDirName:"l1-hosts",slug:"/l1-hosts/networking",permalink:"/hab-guide/docs/l1-hosts/networking",draft:!1,editUrl:"https://github.com/GildedPleb/hab-guide/edit/master/website/docs/l1-hosts/networking.md",tags:[],version:"current",lastUpdatedBy:"GildedPleb",lastUpdatedAt:1672877576,formattedLastUpdatedAt:"Jan 5, 2023",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Ansible",permalink:"/hab-guide/docs/l1-hosts/ansible"},next:{title:"Stand-up Vanilla Hosts",permalink:"/hab-guide/docs/l1-hosts/vanilla-host"}},l={},d=[{value:"Networking",id:"networking",level:2},{value:"Designate IP Address Block",id:"designate-ip-address-block",level:2},{value:"Adding Raw Hosts",id:"adding-raw-hosts",level:2},{value:"Assign Addresses for Raw Hosts",id:"assign-addresses-for-raw-hosts",level:3},{value:"Using a Generic Router",id:"using-a-generic-router",level:3},{value:"Using pfSense",id:"using-pfsense",level:3},{value:"Ping It",id:"ping-it",level:3}],p={toc:d};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"stand-up-raw-hosts"},"Stand-up Raw Hosts"),(0,r.kt)("h2",{id:"networking"},"Networking"),(0,r.kt)("p",null,"Unless you have an atypical network setup, your router is your source of truth\nfor your entire network architecture. As such, it should be consulted first as\nthe entry point for any HAB Node."),(0,r.kt)("p",null,"Further, it is very important for Kubernetes to keep ",(0,r.kt)("em",{parentName:"p"},"static")," addresses for all\nnodes in the cluster, and to have addresses it can assign to exposed\nservices/ingress. Before designating IP addresses, inventory the computers that\nyou intend to use in the cluster, and try to think about how your cluster might\nexpand. It will be far easier to assign new computers (should new computers\nenter the cluster) to reserved pools than it will be to continue to find new\naddresses for them ad hoc."),(0,r.kt)("h2",{id:"designate-ip-address-block"},"Designate IP Address Block"),(0,r.kt)("p",null,"This may simply look like a plan kept on paper, or you may have a router that\ncan create groups of aliases. The variety of ways to solve this is pretty big as\nthere are many routers out there, so do consult your router user manual as a\nfirst resource."),(0,r.kt)("p",null,"For this guide, we have 2 NUCs and 5 Pis, so, we will use the schema:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Block: 10.1.0.x"),(0,r.kt)("th",{parentName:"tr",align:null},"Assigned For"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},".20 - .29"),(0,r.kt)("td",{parentName:"tr",align:null},"Raspberry Pis")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},".30 - .39"),(0,r.kt)("td",{parentName:"tr",align:null},"NUCs")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},".40 - .49"),(0,r.kt)("td",{parentName:"tr",align:null},"Non-conforming expansion hosts")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},".50 - .99"),(0,r.kt)("td",{parentName:"tr",align:null},"Kubernetes")))),(0,r.kt)("p",null,"As such, we should always expect to find a Raspberry Pi at ",(0,r.kt)("inlineCode",{parentName:"p"},"10.1.0.20"),", or a NUC\nat ",(0,r.kt)("inlineCode",{parentName:"p"},"10.1.0.30")," and we have a block of IPs reserved for any new computer we wish\nto add."),(0,r.kt)("p",null,"Thought we are using pfSense, we are not adding these to aliases, simply to keep\nclutter down (actually, they are a part of a larger alias group). We are\nsectioning off the IPs ",(0,r.kt)("inlineCode",{parentName:"p"},"10.1.0.20"),"-",(0,r.kt)("inlineCode",{parentName:"p"},"10.1.0.99")," so that no other services (Like\nDHCP) can assign or use these addresses."),(0,r.kt)("h2",{id:"adding-raw-hosts"},"Adding Raw Hosts"),(0,r.kt)("p",null,"Finally, we can start to define some Raw hosts for our cluster!"),(0,r.kt)("p",null,"In this guide, we will add a few types of hosts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Raspberry pis"),(0,r.kt)("li",{parentName:"ul"},"NUCs")),(0,r.kt)("p",null,"After you see how each of the above is configured, you should at least have a\nframework for making any machine a host:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"BONUS: Generic PC")),(0,r.kt)("h3",{id:"assign-addresses-for-raw-hosts"},"Assign Addresses for Raw Hosts"),(0,r.kt)("p",null,"To start, we need to have our router see MAC addresses for our hosts. We will be\nre-imaging everything after we get static mapping, so it really doesn't matter\nwhat your starting place is, or how you get MAC addresses, what matters is\ngetting a MAC address and IP address visible in your router and knowing which\nhost it is in reference to."),(0,r.kt)("p",null,"Get your host computers into a state where they can get power and LAN access and\nare viewable from your routers Admin page. If you are using non-imaged Pi's this\nmay mean burning an image first, and may also mean the same for NUCs or any\nother device. Almost every device which is already imaged or already has an OS\nshould be able to communicate with the router simply by plugging it in to the\nnetwork. MAC addresses are factory set, and though they can be changed, we won't\nneed to change them for this guide, and they shouldn't change image-to-image (we\nassume...)."),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"Be sure all hosts and all SD/SSD media do not have any information on them that\nis not backed up or can not be lost. ",(0,r.kt)("em",{parentName:"p"},"Imaging will erase this information."))),(0,r.kt)("h3",{id:"using-a-generic-router"},"Using a Generic Router"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Attach the hosts to your LAN network."),(0,r.kt)("li",{parentName:"ol"},"Using the router you have, for each host in DHCP:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Name the record the hosts name, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"pi1")),(0,r.kt)("li",{parentName:"ol"},"Assign the host MAC address to a static address."),(0,r.kt)("li",{parentName:"ol"},"Delete old leases associated with the MAC address."),(0,r.kt)("li",{parentName:"ol"},"Delete entries in ARP tables (if necessary)."))),(0,r.kt)("li",{parentName:"ol"},"Then, in DNS Resolution (assuming your router resolves DNS names):",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Add a record to resolve the host name, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"pi1"),", to the DHCP assigned IP\naddress."),(0,r.kt)("li",{parentName:"ol"},"Or, if different from what was assigned, add a record to resolve the host\nname to the static address")))),(0,r.kt)("p",null,"It should be prudent to reboot your host just to make sure it takes, and is\ngetting the same IP address."),(0,r.kt)("h3",{id:"using-pfsense"},"Using pfSense"),(0,r.kt)("p",null,"If your router is pfSense, for each entry you would do something like this:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Find each Node in DHCP leases,\n",(0,r.kt)("inlineCode",{parentName:"li"},"Services / DHCP Server / (The Interface that the host is connected to)")),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Add Static Mapping")),(0,r.kt)("li",{parentName:"ol"},"Add appropriate IP address",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"In pfSenese, it can't be the address assigned by DHCP (or an address in the\nDHCP range) so when you change it, you should restart the host after\ncompleting all these steps."))),(0,r.kt)("li",{parentName:"ol"},"Add appropriate Hostname: e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"pi1"))),(0,r.kt)("admonition",{title:"IMPORTANT",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"This name needs to match the hostname for that host when defined, and should not\nbe changed here.")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Check: ",(0,r.kt)("inlineCode",{parentName:"li"},"\u2705 ARP Table Static Entry")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"SAVE")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"CONFIRM SAVED")),(0,r.kt)("li",{parentName:"ol"},"Delete previous lease in arp table and DHCP leases (if not already\nexpired/purged)"),(0,r.kt)("li",{parentName:"ol"},"Goto ",(0,r.kt)("inlineCode",{parentName:"li"},"DNS Resolver")),(0,r.kt)("li",{parentName:"ol"},"Add the appropriate name server resolution to the bottom",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Domain Name: e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"pi1")),(0,r.kt)("li",{parentName:"ol"},"IP Address: as per what was assigned in DHCP for ",(0,r.kt)("inlineCode",{parentName:"li"},"pi1"))))),(0,r.kt)("p",null,"Upon completion of this step, you should be able to ping every host on your\nnetwork from your router by their name. In pfSense, you can open up the ",(0,r.kt)("inlineCode",{parentName:"p"},"ping"),"\ntool and ",(0,r.kt)("inlineCode",{parentName:"p"},"ping pi1"),"."),(0,r.kt)("h3",{id:"ping-it"},"Ping It"),(0,r.kt)("p",null,"Your control computer also needs to be connected to the same network in a way\nthat it can view the hosts on the network (look out for firewall settings,\nthough it will not affect most users). From your control computer, you should be\nable to ping all hosts:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"% ping pi1\nPING pi1 (10.1.0.20): 56 data bytes\n64 bytes from 10.1.0.20: icmp_seq=0 ttl=63 time=1.185 ms\n64 bytes from 10.1.0.20: icmp_seq=1 ttl=63 time=1.222 ms\n64 bytes from 10.1.0.20: icmp_seq=2 ttl=63 time=1.109 ms\n")),(0,r.kt)("p",null,"Are they all pingable? If so, congratulations! You now have a full set of Raw\nHosts. Let's bring them into the Vanilla State, so they are ready for k3s!"))}u.isMDXComponent=!0}}]);