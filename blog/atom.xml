<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://gildedpleb.github.io/hab-guide/blog</id>
    <title>HAB Node Blog</title>
    <updated>2022-04-02T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://gildedpleb.github.io/hab-guide/blog"/>
    <subtitle>HAB Node Blog</subtitle>
    <icon>https://gildedpleb.github.io/hab-guide/img/favicon.png</icon>
    <entry>
        <title type="html"><![CDATA[A Caught in the Wild Case Study on HAB Node Importance]]></title>
        <id>Case-study-1</id>
        <link href="https://gildedpleb.github.io/hab-guide/blog/Case-study-1"/>
        <updated>2022-04-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Actual fail logs from a failed node, and the k8s responce]]></summary>
        <content type="html"><![CDATA[<p>To provide some context around why HAB Nodes are practically important, this is
a real log from <a href="https://github.com/btcsuite/btcd" target="_blank" rel="noopener noreferrer">btcd</a> syncing the bitcoin
live net that we witnessed which demonstrates the power of HAB Nodes:</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:16:05.338 [INF] SYNC: Processed 7 blocks in the last 11.34s (5235 transactions, height 681505, 2021-05-02 09:19:37 +0000 UTC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:16:15.370 [INF] SYNC: Processed 6 blocks in the last 10.03s (7148 transactions, height 681511, 2021-05-02 10:08:49 +0000 UTC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:16:25.801 [INF] SYNC: Processed 7 blocks in the last 10.43s (5342 transactions, height 681518, 2021-05-02 10:33:55 +0000 UTC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:16:35.489 [INF] SYNC: Rejected block 0000000000000000000c0b575b54782ac1233b52167a4360b387a92aad6d5c36 from 106.70.152.247:8333 (outbound): output fb1e8da2c605b140af57988ebfd01337c48981b6bea574814471888644a87179:374 referenced from transaction 574ed80323af61a44fde23fdfa353d9fcfd4044e746e5d71bb677539873a4d69:81 either does not exist or has already been spent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:16:35.505 [INF] SYNC: Rejected block 00000000000000000000a62dbd00aac10221e14ee31e4ccf0f69b5992ef2dc09 from 106.70.152.247:8333 (outbound): previous block 0000000000000000000c0b575b54782ac1233b52167a4360b387a92aad6d5c36 is known to be invalid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:16:35.520 [INF] CHAN: Adding orphan block 0000000000000000000504f79236c4c8cbfee36d23250d3e4b741f0866578586 with parent 00000000000000000000a62dbd00aac10221e14ee31e4ccf0f69b5992ef2dc09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Depending on ones node setup, an event like this might terminate the node, as 1
minute later, this node was terminated:</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:17:31.986 [INF] CHAN: Adding orphan block 00000000000000000002fb1e3184747bf39b69a1d12d4fa0c27e333e916e10ad with parent 000000000000000000029b9cf49faf90b0a83041c399abf1cef921456132ef20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:17:33.965 [INF] CHAN: Adding orphan block 0000000000000000000314d2b93903aab6bc9f12401eeb2d98ac5e641352a355 with parent 00000000000000000002fb1e3184747bf39b69a1d12d4fa0c27e333e916e10ad</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:17:34.270 [INF] BTCD: Received signal (terminated).  Shutting down...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:17:34.270 [INF] BTCD: Gracefully shutting down the server...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:17:34.270 [WRN] SRVR: Server shutting down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:17:34.278 [INF] SRVR: Server shutdown complete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:17:34.278 [INF] BTCD: Gracefully shutting down the database...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:17:34.279 [INF] BTCD: Shutdown complete</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Even if this was an ephemeral or user error (btcd was not shut down by the
operator, but it may have been miss-configured), btcd has encountered events
like this in <a href="https://github.com/btcsuite/btcd/issues/1024" target="_blank" rel="noopener noreferrer">the past</a>. It would
be optimistic, at best, to think that <em>any</em> FOSS node implementation is immune
from such events, which moving forward, might manifest themselves as zero-days,
for zero-days are a problem inherent to all software.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="a-node-watchman">A Node Watchman<a class="hash-link" href="#a-node-watchman" title="Direct link to heading">â€‹</a></h3><p>There is something to be said for sussing out root issues, submitting PRs, and
getting issues resolved at the source, but there is also something to be said
for end user plebs who can not code, having the power to diversify away this
kind of risk entirely.</p><p>Among other things, a HAB Cluster accomplishes this: it becomes the dedicated
watchman of all local nodes.</p><p>The above logs were from a Kubernetes pod in the <a href="/hab-guide/poc">Proof Of Concept</a> HAB
node. Within 30 seconds of the node shutting down, Kubernetes saw the
degradation in service, rebooted the node, and it re-synced past the problematic
block, without any human intervention:</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:18:04.431 [INF] BTCD: Version 0.22.0-beta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:18:04.432 [INF] BTCD: Loading block database from '/root/.btcd/mainnet/blocks_ffldb'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:18:04.932 [INF] BCDB: Detected unclean shutdown - Repairing...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:18:04.938 [INF] BCDB: Database sync complete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:18:04.938 [INF] BTCD: Block database loaded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:21:20.284 [INF] SYNC: Processed 2 blocks in the last 12.31s (1834 transactions, height 681515, 2021-05-02 10:29:45 +0000 UTC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:21:35.062 [INF] SYNC: Processed 3 blocks in the last 14.77s (1878 transactions, height 681518, 2021-05-02 10:33:55 +0000 UTC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-04-02 19:21:49.979 [INF] SYNC: Processed 2 blocks in the last 14.91s (2319 transactions, height 681520, 2021-05-02 10:37:27 +0000 UTC)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But more importantly than that, the HAB node itself, which was simultaneously
running bitcoind, experienced no downtime from the perspective of the bitcoin
network or any higher layers running locally, were there any at the time of
running this sync.</p>]]></content>
        <author>
            <name>Gilded Pleb</name>
            <email>gildedpleb@protonmail.com</email>
            <uri>https://github.com/GildedPleb</uri>
        </author>
        <category label="Case-Study" term="Case-Study"/>
        <category label="Failure-Recovery" term="Failure-Recovery"/>
    </entry>
</feed>