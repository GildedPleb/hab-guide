<!doctype html>
<html lang="en" dir="ltr" class="mdx-wrapper mdx-page plugin-pages plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">HAB Node Proof of Concept | HAB Node</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://gildedpleb.github.io/hab-guide/img/og_image.png"><meta data-rh="true" name="twitter:image" content="https://gildedpleb.github.io/hab-guide/img/og_image.png"><meta data-rh="true" property="og:url" content="https://gildedpleb.github.io/hab-guide/poc"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="HAB Node Proof of Concept | HAB Node"><meta data-rh="true" name="description" content="Technical design considerations and specifications for the Proof of Concept"><meta data-rh="true" property="og:description" content="Technical design considerations and specifications for the Proof of Concept"><link data-rh="true" rel="icon" href="/hab-guide/img/favicon.png"><link data-rh="true" rel="canonical" href="https://gildedpleb.github.io/hab-guide/poc"><link data-rh="true" rel="alternate" href="https://gildedpleb.github.io/hab-guide/poc" hreflang="en"><link data-rh="true" rel="alternate" href="https://gildedpleb.github.io/hab-guide/poc" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/hab-guide/blog/rss.xml" title="HAB Node RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/hab-guide/blog/atom.xml" title="HAB Node Atom Feed"><link rel="stylesheet" href="/hab-guide/assets/css/styles.6f2a620f.css">
<link rel="preload" href="/hab-guide/assets/js/runtime~main.cdde320f.js" as="script">
<link rel="preload" href="/hab-guide/assets/js/main.c5dc390f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<style data-styled="" data-styled-version="5.3.6"></style><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:pink;color:#091E42" role="banner"><div class="content_knG7 announcementBarContent_xLdY">The Guide is presently under active development, and requires additional undocumented steps to complete as is. See <a href="/hab-guide/docs/Introduction/intro"> Warning. </a></div></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/hab-guide/"><div class="navbar__logo"><img src="/hab-guide/img/ionico.png" alt="HAB Node logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/hab-guide/img/ionico.png" alt="HAB Node logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/hab-guide/poc">PoC</a><a class="navbar__item navbar__link" href="/hab-guide/why">Why?</a><a class="navbar__item navbar__link" href="/hab-guide/how">How?</a><a class="navbar__item navbar__link" href="/hab-guide/docs/Introduction/intro">BYO</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/hab-guide/blog">Blog</a><a class="navbar__item navbar__link" href="/hab-guide/support">Support</a><a href="https://github.com/gildedpleb/hab-guide" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_j9I6"><div class="col col--8"><article><h1>Proof of Concept</h1><p>Technical design considerations and specifications for the Proof of Concept
Highly Available Bitcoin Node featured herein.</p><p>The Ionico Base Node: <img loading="lazy" alt="HAB Node White Backdrop" src="/hab-guide/assets/images/white_profile-3297e9b2693e0e136f435112eacf21a9.JPG" width="2003" height="1427" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="name">Name<a class="hash-link" href="#name" title="Direct link to heading">​</a></h2><p>It is named after
<a href="https://www.thoughtco.com/what-is-an-ionic-column-177515" target="_blank" rel="noopener noreferrer">Ionic Columns</a>, not
just for the essence of the column as vertical blades with alternating convex
and concave space, but, in particular, for the base which is &quot;stacked disks&quot;.
And, because of course, pillars are the quintessential symbol of Western
Civilization.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="design-considerations">Design Considerations<a class="hash-link" href="#design-considerations" title="Direct link to heading">​</a></h2><p>The only real purpose of this project was that it needed to be a functional
Bitcoin node which was highly available, as outlined in the docs elsewhere.
Everything else came in second place, including all higher layer services, like
lightning, which was not implemented for this PoC, and security concerns,
outlined below.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="constraints">Constraints<a class="hash-link" href="#constraints" title="Direct link to heading">​</a></h3><p>The largest <em>guiding</em> constraints when designing this node were these:</p><ol><li>It should be cheaper than a high-end laptop</li><li>It should be quiet enough for running in a room with humans</li><li>It should look awesome</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cost">Cost<a class="hash-link" href="#cost" title="Direct link to heading">​</a></h3><p>At no point were we worried about exceeding the cost constraint. It should not
come as a surprise to anyone that the second you leave the walled garden of,
say, Apple, everything gets considerably cheaper (if perhaps not the most
cutting edge or beautiful).</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="power">Power<a class="hash-link" href="#power" title="Direct link to heading">​</a></h3><p>Managing 7x clunky power cables would have made this project unmanageable for
consumer bare-metal, and it would have made it look like a rats nest. Power Over
Ethernet (PoE) hats were deployed for the Raspberry Pi hosts bringing total
power bricks down to three, and massively reducing cabling.</p><p>Additionally, many USB 3.1 SSD hard drives (especially in higher TB ranges) draw
too much power from a Raspberry Pi, and are thus unstable and need external
power sources—which, again, was a no-go for this build. Samsung&#x27;s 2 TB external
drive was the only SSD hard drive solutions found (at build time) after
considerable research and testing.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="noise">Noise<a class="hash-link" href="#noise" title="Direct link to heading">​</a></h3><p>Consumer deployment requires ultra quiet operation. Even the world&#x27;s quietest
active cooling system for an RPi can become problematic when multiplied by five.
Not to mention moving parts are far more prone to breaking.</p><p>Passive cooling for the Raspberry Pis and open casing were used to facilitate
air flow. Though not photographed, the node lives on an open-faced rack that
provides vertical and unobstructed airflow between the pi hosts. In extreme
conditions, a standard desk or box fan can be applied externally to the entire
underside of the node, as the air has a clean exit upward, dramatically reducing
temps.</p><p>Our hats are off to <a href="https://geekworm.com/" target="_blank" rel="noopener noreferrer">Geekworm</a> for designing a PoE hat
that fits with a passive cooling case. Pun intended.</p><p>This node is quieter than a mouse.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="looks">Looks<a class="hash-link" href="#looks" title="Direct link to heading">​</a></h3><p>An apropos mix of Borg, Nolan Batman, Gunmetal and Light:
<img loading="lazy" alt="HAB Node on Blue Background" src="/hab-guide/assets/images/poc_blue_flat-2154892173e2d4b7f21a2e81a7b53555.png" width="1280" height="960" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="hardware">Hardware<a class="hash-link" href="#hardware" title="Direct link to heading">​</a></h2><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Warning: Fiat Prices Ahead</div><div class="admonitionContent_S0QG"><p>This hardware was purchased at variable prices (especially for the 5x items)
mostly over the course of 6 months from Oct &#x27;21 to April &#x27;22 while testing and
rebuilding. The prices shown constitute averages, and mostly do not include the
rapid price rises in consumer electronics caused by fiat currency. In other
words, prices you are about to read are practically meaninglessness apart from
their relationship to one another, which itself is wanting.</p></div></div><table><thead><tr><th>Item</th><th align="right">Cost</th><th align="center">Count</th><th align="right">Total</th></tr></thead><tbody><tr><td>Raspberry Pi 4 Model B 8 GB RAM, 1.5GHz Quad-core</td><td align="right">$142.99</td><td align="center">5</td><td align="right">$714.95</td></tr><tr><td>Samsung T5 Portable SSD 2 TB, MU-PA2T0B/AM</td><td align="right">$219.95</td><td align="center">5</td><td align="right">$1,099.75</td></tr><tr><td>1 inch USB-C Male to USB-3.0 Male Adapter</td><td align="right">$7.99</td><td align="center">5</td><td align="right">$39.95</td></tr><tr><td>Geekworm for Raspberry Pi 4 Model B/Pi 3 Model B+, Raspberry Pi Power Over Ethernet (PoE+) X765 PoE HAT 802.3at/802.3af 5Vdc</td><td align="right">$34.99</td><td align="center">5</td><td align="right">$174.95</td></tr><tr><td>Geekworm Raspberry Pi 4 Model B CNC Ultra-Thin Aluminum Alloy Metal Passive Cooling Case</td><td align="right">$26.99</td><td align="center">5</td><td align="right">$134.95</td></tr><tr><td>Monoprice 134211 Cat6 Ethernet Patch Cable, .5ft, Black, Stranded, 550MHz, UTP, Pure Bare Copper Wire, 32AWG, Micro SlimRun Series</td><td align="right">$1.79</td><td align="center">5</td><td align="right">$10.74</td></tr><tr><td>HVAZI 240pcs M2.5 Nylon Hex Spacer Standoffs Screws Nuts Assortment Kit, Male-Female, Black</td><td align="right">$11.99</td><td align="center">1</td><td align="right">$11.99</td></tr><tr><td>Intel NUC 11, Core i3-1115G4 2-Core, 3.0 GHz–4.1 GHz Turbo, NUC11PAHi3</td><td align="right">$395.00</td><td align="center">2</td><td align="right">$790.00</td></tr><tr><td>Samsung 970 EVO Plus SSD 2 TB NVMe M.2 Internal Solid State Hard Drive w/ V-NAND, MZ-V7S2T0B/AM</td><td align="right">$209.99</td><td align="center">2</td><td align="right">$419.98</td></tr><tr><td>32 GB DDR4 3200MHz PC4-25600 1.2V 2Rx8 260-Pin SODIMM Laptop RAM, M471A4G43AB1-CWE</td><td align="right">$138.95</td><td align="center">4</td><td align="right">$555.80</td></tr><tr><td>Monoprice 107687 3ft 18AWG Grounded AC Power Cord, 10A (NEMA 5-15P to IEC-320-C5)</td><td align="right">$8.95</td><td align="center">2</td><td align="right">$17.90</td></tr><tr><td>Cat6 Ethernet Cable 1ft Black, 6 Pack, flat, snagless Rj45 Connectors</td><td align="right">$13.99</td><td align="center">1</td><td align="right">$13.99</td></tr><tr><td>Netgear 8-Port Gigabit Ethernet Unmanaged PoE Switch w/ 8 x PoE+ @ 123W, GS108PP</td><td align="right">$109.99</td><td align="center">1</td><td align="right">$109.99</td></tr><tr><td></td><td align="right"></td><td align="center"><strong>Total</strong></td><td align="right"><strong>$4,094.94</strong></td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cluster-totals">Cluster Totals<a class="hash-link" href="#cluster-totals" title="Direct link to heading">​</a></h3><table><thead><tr><th align="center">Memory</th><th align="center">Storage</th><th align="center">Cores</th></tr></thead><tbody><tr><td align="center">168 GB</td><td align="center">14 TB</td><td align="center">24</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="comparison">Comparison<a class="hash-link" href="#comparison" title="Direct link to heading">​</a></h3><p>As of Dec 2022, a maxed out 16‑inch MacBook Pro Apple M1 Max chip:</p><table><thead><tr><th align="center">Memory</th><th align="center">Storage</th><th align="center">Cores</th><th align="right">Total Cost</th></tr></thead><tbody><tr><td align="center">64 GB</td><td align="center">8 TB</td><td align="center">58</td><td align="right"><strong>$6,099.00</strong></td></tr></tbody></table><p>All this for less than an Apple MacBook
<img loading="lazy" alt="HAB Node Black Backdrop" src="/hab-guide/assets/images/fin_black-a0d8af89a944d08d99ef87b09feccd5b.png" width="2049" height="1536" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="single-points-of-failure">Single Points of Failure<a class="hash-link" href="#single-points-of-failure" title="Direct link to heading">​</a></h2><p>The focus of this build, again, was to present a Proof of Concept, it was to
prove that we <em>could</em> eliminate choke-points, but not, necessarily, to eliminate
every single one. But we did get some notable ones.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="eliminated">Eliminated<a class="hash-link" href="#eliminated" title="Direct link to heading">​</a></h3><ul><li><strong>Hardware Failure:</strong> We have eliminated the most problematic node SPF as it
almost for sure exists for almost every current self-hosted bitcoin node
operator: hard drive or other hardware failure.</li><li><strong>Dependency Tree:</strong> Apart from this, it is also worth mentioning that
Kubernetes itself can run in HA mode, meaning there are at least 3 master
hosts (or master nodes in k8s terminology): 2 pis, and 1 NUC. As such, we have
eliminated a key SPF in a dependency while introducing said dependency.</li><li><strong>Implementation/Versioning Risk:</strong> Lastly, we have eliminated bitcoin
implementation and versioning choke points, which should be a key
consideration for all pleb operators who are not core contributors.</li></ul><p>Not featured, we have put this node behind a pre-existing UPS that was available
to us, as power in our area has a tendency to flicker. This gives the node
limited power redundancy for roughly 1 hour, which is far in excess of perceived
risk.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="remaining">Remaining<a class="hash-link" href="#remaining" title="Direct link to heading">​</a></h3><ul><li><strong>Geographic Location:</strong> Because this node is designed with a Hydra Option in
mind, it has the ability to be geographically dispersed. As pictured, this is
obviously not employed. But it does make the pictures better! A first order
roadmap item is to get a node host in the cloud, which would remove this SPF.</li><li><strong>Router:</strong> The router used for this node (a pfSense box) gives many options
for removing SPFs in internet provider, VPNs, and micro-geo. However, only one
router is serving this node, which itself is an SPF. Multiple routers would
need to be introduced and networked together at different locations to fight
this risk.</li><li><strong>Internet Provider:</strong> It is worth calling out again, that this node is only
served by one internet provider. The option exists to add redundancy here,
both with satellite (Bitcoin Satellite) and cell via the pfSense box.
Additionally, RPis can employ cell hats.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="uptime">Uptime<a class="hash-link" href="#uptime" title="Direct link to heading">​</a></h2><p>As you can see, 169 days of uptime on the first build is great!
<img loading="lazy" alt="Uptime" src="/hab-guide/assets/images/uptime-8418eb7f7191297ceab2b3c2ff068b5d.png" width="926" height="208" class="img_ev3q"> However, shortly after this screenshot was taken, the
entire cluster <a href="#cluster-crash">crashed</a>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Note on Cluster Resource Allocations</div><div class="admonitionContent_S0QG"><p>As you have probably noticed, bitcoind was only running on 3 off 7 nodes. This
first build also included a bcoin instance, a non-clustered bitcoind instance, a
btcd instance, and 1 node reserved for N+1 (to see the full list and
configuration, check out the chart
<a href="https://github.com/GildedPleb/helm-charts/blob/master/charts/hab/examples.md#poc-hab-node" target="_blank" rel="noopener noreferrer">here</a>).
Both btcd and bcoin ran into reliability issues over the same time frame, as
expected, and entered crash loop back-off regularly, and were eventually shut
down.</p><p>The standalone bitcoind instance ran on one of the NUCs and was used for
performance testing. Thus, it did not accurately track uptime at all.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="performance">Performance<a class="hash-link" href="#performance" title="Direct link to heading">​</a></h2><p>Because of Raspberry Pi limitations, it became clear that the NUCs needed to
overcompensate, especially with regard to RAM. Both NUCs have max RAM at 64 GB,
allowing them to sync the bitcoin blockchain from scratch without dumping the
cache. This, increasingly, is the single most important factor for node sync.</p><p>The NUCs can sync bitcoin core in about 8 hours on ultra basic 200 Mbps
internet.</p><p>If you are reading this, you are probably already aware of Raspberry Pi Node
sync times (or really, any device with less than say, 30 GB of available RAM for
the db cache).<img loading="lazy" alt="HAB Node vertical black and white" src="/hab-guide/assets/images/poc_tower-8fb403767b821907986ed6c80836a1fe.png" width="960" height="1280" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="lessons-learned">Lessons Learned<a class="hash-link" href="#lessons-learned" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cluster-crash">Cluster Crash<a class="hash-link" href="#cluster-crash" title="Direct link to heading">​</a></h3><p>The cluster crashed shortly after reaching 6 months of uptime because the
Software Update Controller (SUC) updated k3s, and Longhorn, which releases on a
different schedule, became reliant on
<a href="https://github.com/longhorn/longhorn/issues/4003" target="_blank" rel="noopener noreferrer">deprecated resources</a>. The
SUC truly lived up to its abbreviated name! /s.</p><p><strong>Ways Forward:</strong></p><ol><li>Remove the reliance on Longhorn - Workable, as it is only minimally needed,
and removes a dependency, which is always good.</li><li>Remove the SUC - Workable. However, this means more manual maintenance.</li><li>Alter how aggressive the SUC is - Workable, and most amicable way forward.
Presently, it targets <code>latest</code>.</li><li>Remove both - Workable. Both can be thought of as non-essential auxiliary
features, but they do make life easier, for the most part. More discussion
here is needed.</li><li>Update Longhorn to the patched but unreleased version, which fixes the bug.
This was the action we took, as it was the simplest, had community support,
and the node was fully functional again after only a few hours of downtime.</li></ol><p>Thankfully, this was a nonpublic beta version for this very reason. And will not
have this issue when using
<a href="https://github.com/longhorn/longhorn/milestone/33" target="_blank" rel="noopener noreferrer">Longhorn 1.4</a> (released
December 30, 2022). But it does bring to light the difficulty of introducing
dependencies at the Live K3s level. Baby steps.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="hard-drives">Hard Drives<a class="hash-link" href="#hard-drives" title="Direct link to heading">​</a></h3><p>Surprisingly for us, but perhaps unsurprisingly for others, hard drives were a
problematic focal point in this build. The original plan was to employ simple
USB stick hard drives as they are now very affordable and in the +1 TB range,
and plug them into pis. What we failed to account for was just how much power
these tiny hard drives need on Raspberry Pis, how much hard drive space was
actually needed in our block storage solution, Longhorn, and how performant they
needed to be. Once we realized the USB sticks were out because size,
performance, and power, we investigated NVMe USB adapters, but came to find out
that they were out because of power. After many purchases, tests, and returns,
we finally realized we needed to ride the minimums of acceptable performance
just to get the least power and most space. This, in turn, pushed us toward
adding NUCs to the cluster, which was not a part of the original design, but a
welcome addition.</p><p><strong>Ways Forward:</strong></p><p>The way forward here is simple: front load more research into hardware and
software specifications and requirements. At the end of the day, Raspberry Pis
are cool and all, but until Pi 5 is released, and we get to see the specs, we
would not recommend anyone to buy additional Raspberry Pis to incorporate into a
HAB Node, or to even use as a regular node. If you have pis, use then, but if
you are going to buy hardware, buy hardware which has better performance and
extensibility than Pi&#x27;s.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="host-diversification">Host Diversification<a class="hash-link" href="#host-diversification" title="Direct link to heading">​</a></h3><p>We placed a high premium on aesthetics for this node too early in the build and
the pictures do look very pretty. However, as we have come to realize, no HAB
Node should not have 5, or even 3, or maybe even 2 of the same computer host.
The problem here is that it can introduce perverse incentives for any single
manufacture, via economies of scale. Say, if someone realizes that the Raspberry
Pi Foundation is primarily manufacturing HAB Nodes, and those RPi hosts
constitute a majority of hosts in the Bitcoin Network. This introduces an attack
vector if one wishes to attack Bitcoin and was recently and briefly outlined by
<a href="https://twitter.com/provoost" target="_blank" rel="noopener noreferrer">Sjors</a>, a core contributor, on
<a href="https://podcasts.apple.com/us/podcast/383-bitcoin-a-work-in-progress-with-sjors-provoost/id1292381204?i=1000590398619" target="_blank" rel="noopener noreferrer">TFTC</a>.</p><p><strong>Ways Forward:</strong></p><p>Employ as many manufacturers as possible, where none can materially impact your
node&#x27;s threat model. E.g. if you have N+1, you can afford to have 1 of each type
of host, if you have N+2, you can afford to have 2 of each type of host, but you
should never have a single type of host that constitutes a majority of hosts.
Obviously, moving above 2x one type of host, without letting that host become a
majority, while also maintaining N+X, can completely balloon the node cost.</p><p>Additionally, it might be worth exploring getting more unique nodes, and turning
the Pis into routers so that each Pi router can have one node behind it. Each of
the Pi routers then live at various dispersed locations and are networked
together via a VPN or TOR.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>The inimitable Ionico Base node, but in candy apple red:
<img loading="lazy" alt="Node with red background" src="/hab-guide/assets/images/feature_aesthetics_node-36291b2ff1cbd1d893d80c6c5e7fef3b.png" width="2049" height="1536" class="img_ev3q"> Undoubtedly, there
are <em>better</em> self-hosted solutions out there, as this one does little except
scratch the surface of what is possible, and we look forward to seeing ones that
exceed this project!</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h3><p>We have built a variously defined Highly Available Bitcoin Node. Though a few
single points of failure remain, we have eliminated a great deal of the most
pressing ones, and have retained an uptime of +169 days, while spinning up and
tearing down many other nodes running on the same cluster. In short, we met the
goals of creating a quiet, self-hosted HA Bitcoin node, under budget, that looks
great.</p><p>Many lessons where learned along the way, and this node took many rounds of
building and tearing down to get right: 6 months of active free-time/part-time
development, and 6 months of passive monitoring. To complete this project, it
was essential to have experience in networking, pfSense, Kubernetes, Helm,
Sprig, YAML, and Ansible. We hope that in the guide, the essential lessons have
been passed on while abstracting away as much as possible to make the process of
building more of these nodes palatable for more people.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="looking-back">Looking Back<a class="hash-link" href="#looking-back" title="Direct link to heading">​</a></h3><p>This Bitcoin node started as an idea in 2019 with one Raspberry Pi (now <code>pi5</code>,
the Pi closest to the NUCs in the photos on this page), an old hard drive, a
love for Bitcoin, and the knowledge that
<a href="https://kubernetes.io/blog/2015/12/creating-raspberry-pi-cluster-running/" target="_blank" rel="noopener noreferrer">k8s could run on a Pi cluster</a>.
But who knew how to combine the lot? When we started realizing in mid 2021 that
we could build a Highly Available node, from skills gleaned in professional full
stack development, the project became an itch that must be scratched. After a
few months of planning and research, we started building the Ionico Base node in
Oct &#x27;21 with the addition of 4 new Raspberry Pis, and 5 USB hard drives (which
did not make it into the final build for reasons we
<a href="/hab-guide/docs/l1-hosts/hardware">discuss elsewhere</a>).</p><p>When we started, self-hosted Kubernetes clusters where still a fairly niche
hobby project, it was not easy finding resources to meet the particular needs of
K8s on Pi&#x27;s, none-the-less clustering Bitcoin Nodes, but a survey of 2022 has
revealed that these types of guides and projects have <em>exploded</em> in popularity.
This is an encouraging
sign.<img loading="lazy" alt="HAB Node vertical black and white" src="/hab-guide/assets/images/intro_power-da45efe83fbcb2a69e8bfa069b099cd4.png" width="1536" height="2049" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="looking-forward">Looking Forward<a class="hash-link" href="#looking-forward" title="Direct link to heading">​</a></h3><p>As you are probably well aware, the resources in this node have gone largely
unused, there is much work still to be done, and many verticals to explore. At
the end of the day, a k8s node can run, well, anything. With Bitcoin as the
economic impetus for keeping uptime high, this opens the door for all sorts of
HA services for self-hosted individuals. Indeed, a HAB node provides the path
for all such services to becoming reliably income producing without sacrifices
to privacy, autonomy, or sovereignty. HAB Nodes empower sovereign plebs at the
edge of the network with the most advanced datacenter tech which was formerly
only meaningful at the center at the center of the cloud.</p><p>Hopefully no other HAB Nodes look like the Ionico Base Node (<em>or costs as
much</em>), indeed, this node is not without its problems, but a HAB Node, in all
its variations, is the only way forward we are aware of that has the ability to
meet HA uptime standards of the cloud, remove as many single-points-of-failure
as possible, and thus has the ability to deliver reliable <em>satoshi income
streams</em> on Lighting and other higher layers, without sacrificing privacy,
autonomy, freedom, rights, or human flourishing. We fully believe that this
version of self-hosted is the future, and we hope that this PoC Node, this
guide, and the code we have written herein, helps make that reality.</p><blockquote><p>&quot;We cannot expect governments, corporations, or other large, faceless
organizations to grant us privacy out of their beneficence.&quot;</p><p>-<!-- --> Eric Hughes, A Cypherpunk&#x27;s Manifesto, 1993</p></blockquote><hr><p>For a more in depth explanation on why this is important, see <a href="/hab-guide/why">Why?</a></p></article></div><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#name" class="table-of-contents__link toc-highlight">Name</a></li><li><a href="#design-considerations" class="table-of-contents__link toc-highlight">Design Considerations</a><ul><li><a href="#constraints" class="table-of-contents__link toc-highlight">Constraints</a></li><li><a href="#cost" class="table-of-contents__link toc-highlight">Cost</a></li><li><a href="#power" class="table-of-contents__link toc-highlight">Power</a></li><li><a href="#noise" class="table-of-contents__link toc-highlight">Noise</a></li><li><a href="#looks" class="table-of-contents__link toc-highlight">Looks</a></li></ul></li><li><a href="#hardware" class="table-of-contents__link toc-highlight">Hardware</a><ul><li><a href="#cluster-totals" class="table-of-contents__link toc-highlight">Cluster Totals</a></li><li><a href="#comparison" class="table-of-contents__link toc-highlight">Comparison</a></li></ul></li><li><a href="#single-points-of-failure" class="table-of-contents__link toc-highlight">Single Points of Failure</a><ul><li><a href="#eliminated" class="table-of-contents__link toc-highlight">Eliminated</a></li><li><a href="#remaining" class="table-of-contents__link toc-highlight">Remaining</a></li></ul></li><li><a href="#uptime" class="table-of-contents__link toc-highlight">Uptime</a></li><li><a href="#performance" class="table-of-contents__link toc-highlight">Performance</a></li><li><a href="#lessons-learned" class="table-of-contents__link toc-highlight">Lessons Learned</a><ul><li><a href="#cluster-crash" class="table-of-contents__link toc-highlight">Cluster Crash</a></li><li><a href="#hard-drives" class="table-of-contents__link toc-highlight">Hard Drives</a></li><li><a href="#host-diversification" class="table-of-contents__link toc-highlight">Host Diversification</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a><ul><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#looking-back" class="table-of-contents__link toc-highlight">Looking Back</a></li><li><a href="#looking-forward" class="table-of-contents__link toc-highlight">Looking Forward</a></li></ul></li></ul></div></div></div></main></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Techical Designs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/GildedPleb/hab-guide" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tutorial on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/GildedPleb/hab-plays" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ansible Plays<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/GildedPleb/helm-charts/blob/master/charts/hab" target="_blank" rel="noopener noreferrer" class="footer__link-item">Helm Chart<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/gildedpleb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/GildedPleb" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Essential Qs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/hab-guide/docs/Introduction/who">Who?</a></li><li class="footer__item"><a class="footer__link-item" href="/hab-guide/docs/Introduction/what">What?</a></li><li class="footer__item"><a class="footer__link-item" href="/hab-guide/why">Why?</a></li><li class="footer__item"><a class="footer__link-item" href="/hab-guide/how">How?</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/hab-guide/poc">Proof of Concept</a></li><li class="footer__item"><a class="footer__link-item" href="/hab-guide/support">Support</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/hab-guide/img/ionico.png" alt="HAB Node" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/hab-guide/img/ionico.png" alt="HAB Node" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2023 HAB Node Project.</div></div></div></footer></div>
<script src="/hab-guide/assets/js/runtime~main.cdde320f.js"></script>
<script src="/hab-guide/assets/js/main.c5dc390f.js"></script>
</body>
</html>